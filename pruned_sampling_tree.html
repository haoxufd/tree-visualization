<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sampling Tree Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            height: 90vh;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .controls {
            margin-bottom: 15px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .tree-container {
            flex: 1;
            overflow: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            position: relative;
            min-height: 400px;
        }
        
        #tree-svg {
            display: block;
            min-width: 100%;
            min-height: 100%;
        }
        
        /* ËäÇÁÇπÊ†∑Âºè */
        .node {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .node:hover {
            filter: brightness(1.1);
        }
        
        .node circle {
            fill: #4CAF50;
            stroke: #2E7D32;
            stroke-width: 2px;
            transition: all 0.2s ease;
        }
        
        .node.root circle {
            fill: #FF9800;
            stroke: #F57C00;
        }
        
        .node.leaf circle {
            fill: #2196F3;
            stroke: #1976D2;
        }

        .node.first-incorrect circle {
            fill: #FF5722;
            stroke: #F44336;
        }
        
        .node.active circle {
            stroke: #FF5722;
            stroke-width: 3px;
            filter: drop-shadow(0 0 8px rgba(255,87,34,0.6));
        }
        
        .node text {
            font-size: 11px;
            font-weight: 500;
            fill: #333;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }
        
        /* ËøûÊé•Á∫øÊ†∑Âºè */
        .link {
            fill: none;
            stroke: #999;
            stroke-width: 1.5px;
            transition: all 0.2s ease;
        }
        
        .link.highlight {
            stroke: #FF5722;
            stroke-width: 2px;
        }
        
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 12px;
        }
        
        .btn:hover {
            background: #1976D2;
        }
        
        /* ‰øÆÊîπÂêéÁöÑ Tooltip Ê†∑Âºè - Áé∞Âú®ÊòØÁªùÂØπÂÆö‰ΩçÁõ∏ÂØπ‰∫éÊ†ëÂÆπÂô® */
        .tooltip {
            position: absolute;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
            max-width: 350px;
            min-width: 280px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            border: 1px solid #555;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            transform: translateY(-10px);
        }
        
        .tooltip.show {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
        
        .tooltip-header {
            font-size: 14px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tooltip-close {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .tooltip-close:hover {
            background: #c0392b;
        }
        
        .tooltip-section {
            margin-bottom: 10px;
        }
        
        .tooltip-label {
            font-weight: bold;
            color: #e74c3c;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 3px;
            display: block;
        }
        
        .tooltip-value {
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            word-break: break-word;
            line-height: 1.4;
            background: rgba(255,255,255,0.1);
            padding: 4px 6px;
            border-radius: 3px;
            margin-bottom: 5px;
        }
        
        .tooltip-text {
            max-height: 120px;
            overflow-y: auto;
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #3498db;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        
        .tooltip-tokens {
            max-height: 80px;
            overflow-y: auto;
            background: rgba(255,255,255,0.05);
            padding: 6px;
            border-radius: 4px;
            font-size: 10px;
            font-family: 'Courier New', monospace;
        }
        
        /* Á°Æ‰øùÊªöÂä®Êù°ÂèØËßÅ */
        .tree-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .tree-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .tree-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .tree-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Tooltip ÊªöÂä®Êù°Ê†∑Âºè */
        .tooltip-text::-webkit-scrollbar,
        .tooltip-tokens::-webkit-scrollbar {
            width: 4px;
        }
        
        .tooltip-text::-webkit-scrollbar-track,
        .tooltip-tokens::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }
        
        .tooltip-text::-webkit-scrollbar-thumb,
        .tooltip-tokens::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <h1>üå≥ Sampling Tree Visualization</h1>
    
    <div class="container">
        <div class="controls">
            <button class="btn" onclick="resetZoom()">ÈáçÁΩÆÁº©Êîæ</button>
            <button class="btn" onclick="fitToContainer()">ÈÄÇÂ∫îÁ™óÂè£</button>
            <button class="btn" onclick="closeTooltip()">ÂÖ≥Èó≠‰ø°ÊÅØÈù¢Êùø</button>
            <span style="margin-left: 20px; color: #666; font-size: 12px;">
                üí° ÁÇπÂáªËäÇÁÇπÊü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØ
            </span>
        </div>
        <div class="tree-container" id="tree-container">
            <svg id="tree-svg"></svg>
        </div>
    </div>

    <script>
        // Á§∫‰æãÊï∞ÊçÆÁªìÊûÑ
        const treeData = {
  "tree_data": {
    "id": 0,
    "name": "Root",
    "score": "N/A",
    "advantage": "N/A",
    "text": "<|im_start|>system\nYou are a helpful assistant.<|i...",
    "full_text": "<|im_start|>system\nYou are a helpful assistant.<|im_end|>\n<|im_start|>user\nIn a single day, it rained for many hours. From 2pm to 4pm, it rained at a rate of 4 inches per hour.  From 4pm to 7pm, it rained at a rate of 3 inches per hour.  And from 7pm to 9pm, it rained at a rate of 0.5 inches per hour.  If the rain gauge started out the day already containing 2 inches of rainwater, how many inches of water will the gauge contain at 9pm? Let's think step by step and output the final answer after \"####\".<|im_end|>\n<|im_start|>assistant\n",
    "token_sequence": [
      151644,
      8948,
      198,
      2610,
      525,
      264,
      10950,
      17847,
      13,
      151645,
      198,
      151644,
      872,
      198,
      641,
      264,
      3175,
      1899,
      11,
      432,
      435,
      2627,
      369,
      1657,
      4115,
      13,
      5542,
      220,
      17,
      5187,
      311,
      220,
      19,
      5187,
      11,
      432,
      435,
      2627,
      518,
      264,
      4379,
      315,
      220,
      19,
      14924,
      817,
      6460,
      13,
      220,
      5542,
      220,
      19,
      5187,
      311,
      220,
      22,
      5187,
      11,
      432,
      435,
      2627,
      518,
      264,
      4379,
      315,
      220,
      18,
      14924,
      817,
      6460,
      13,
      220,
      1597,
      504,
      220,
      22,
      5187,
      311,
      220,
      24,
      5187,
      11,
      432,
      435,
      2627,
      518,
      264,
      4379,
      315,
      220,
      15,
      13,
      20,
      14924,
      817,
      6460,
      13,
      220,
      1416,
      279,
      11174,
      30890,
      3855,
      700,
      279,
      1899,
      2669,
      8482,
      220,
      17,
      14924,
      315,
      11174,
      12987,
      11,
      1246,
      1657,
      14924,
      315,
      3015,
      686,
      279,
      30890,
      6644,
      518,
      220,
      24,
      5187,
      30,
      6771,
      594,
      1744,
      3019,
      553,
      3019,
      323,
      2550,
      279,
      1590,
      4226,
      1283,
      330,
      820,
      3263,
      151645,
      198,
      151644,
      77091,
      198
    ],
    "display_tokens": "[151644, 8948, 198, 2610, 525,...",
    "depth": 0,
    "is_root": true,
    "is_leaf": false,
    "is_first_incorrect": false,
    "children_count": 5,
    "children": [
      {
        "id": 1,
        "name": "Node 1",
        "score": "N/A",
        "advantage": "N/A",
        "text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours.‚áí",
        "full_text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours.‚áí",
        "token_sequence": [
          3830,
          220,
          17,
          5187,
          311,
          220,
          19,
          5187,
          374,
          220,
          19,
          12,
          17,
          28,
          2442,
          19,
          12,
          17,
          28,
          17,
          2452,
          17,
          4115,
          13,
          144016
        ],
        "display_tokens": "[3830, 220, 17, 5187, 311, 220...",
        "depth": 1,
        "is_root": false,
        "is_leaf": false,
        "is_first_incorrect": false,
        "children_count": 1,
        "children": [
          {
            "id": 2,
            "name": "Node 2",
            "score": "N/A",
            "advantage": "N/A",
            "text": "If it rained at a rate of 4 inches per hour, then ...",
            "full_text": "If it rained at a rate of 4 inches per hour, then the total",
            "token_sequence": [
              2679,
              432,
              435,
              2627,
              518,
              264,
              4379,
              315,
              220,
              19,
              14924,
              817,
              6460,
              11,
              1221,
              279,
              2790
            ],
            "display_tokens": "[2679, 432, 435, 2627, 518, 26...",
            "depth": 2,
            "is_root": false,
            "is_leaf": false,
            "is_first_incorrect": false,
            "children_count": 1,
            "children": [
              {
                "id": 3,
                "name": "Node 3",
                "score": "N/A",
                "advantage": "N/A",
                "text": " increase in rainwater in the gauge",
                "full_text": " increase in rainwater in the gauge",
                "token_sequence": [
                  5263,
                  304,
                  11174,
                  12987,
                  304,
                  279,
                  30890
                ],
                "display_tokens": "[5263, 304, 11174, 12987, 304,...",
                "depth": 3,
                "is_root": false,
                "is_leaf": false,
                "is_first_incorrect": false,
                "children_count": 1,
                "children": [
                  {
                    "id": 4,
                    "name": "Node 4",
                    "score": "N/A",
                    "advantage": "N/A",
                    "text": " from 2pm to 4pm is 2*4=<<2*4=8>>8 inches.‚áíFrom 4p...",
                    "full_text": " from 2pm to 4pm is 2*4=<<2*4=8>>8 inches.‚áíFrom 4pm to 7pm is 7-4=3 hours.‚áíIf it rained at a rate of 3 inches per hour, then the total increase in rainwater in the gauge from 4pm to 7pm is 3*3=<<3*3=9>>9 inches.‚áíFrom 7pm to 9pm is 9-7=<<9-7=2>>2 hours.‚áíIf it rained at a rate of 0.5 inches per hour, then the total increase in rainwater in the gauge from 7pm to 9pm is 2*0.5=1 inch.‚áí",
                    "token_sequence": [
                      504,
                      220,
                      17,
                      5187,
                      311,
                      220,
                      19,
                      5187,
                      374,
                      220,
                      17,
                      9,
                      19,
                      28,
                      2442,
                      17,
                      9,
                      19,
                      28,
                      23,
                      2452,
                      23,
                      14924,
                      13,
                      144016,
                      3830,
                      220,
                      19,
                      5187,
                      311,
                      220,
                      22,
                      5187,
                      374,
                      220,
                      22,
                      12,
                      19,
                      28,
                      18,
                      4115,
                      13,
                      144016,
                      2679,
                      432,
                      435,
                      2627,
                      518,
                      264,
                      4379,
                      315,
                      220,
                      18,
                      14924,
                      817,
                      6460,
                      11,
                      1221,
                      279,
                      2790,
                      5263,
                      304,
                      11174,
                      12987,
                      304,
                      279,
                      30890,
                      504,
                      220,
                      19,
                      5187,
                      311,
                      220,
                      22,
                      5187,
                      374,
                      220,
                      18,
                      9,
                      18,
                      28,
                      2442,
                      18,
                      9,
                      18,
                      28,
                      24,
                      2452,
                      24,
                      14924,
                      13,
                      144016,
                      3830,
                      220,
                      22,
                      5187,
                      311,
                      220,
                      24,
                      5187,
                      374,
                      220,
                      24,
                      12,
                      22,
                      28,
                      2442,
                      24,
                      12,
                      22,
                      28,
                      17,
                      2452,
                      17,
                      4115,
                      13,
                      144016,
                      2679,
                      432,
                      435,
                      2627,
                      518,
                      264,
                      4379,
                      315,
                      220,
                      15,
                      13,
                      20,
                      14924,
                      817,
                      6460,
                      11,
                      1221,
                      279,
                      2790,
                      5263,
                      304,
                      11174,
                      12987,
                      304,
                      279,
                      30890,
                      504,
                      220,
                      22,
                      5187,
                      311,
                      220,
                      24,
                      5187,
                      374,
                      220,
                      17,
                      9,
                      15,
                      13,
                      20,
                      28,
                      16,
                      17122,
                      13,
                      144016
                    ],
                    "display_tokens": "[504, 220, 17, 5187, 311, 220,...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": false,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 5,
                        "name": "Node 5",
                        "score": 1.0,
                        "advantage": "N/A",
                        "text": "If the rain gauge started out the day already cont...",
                        "full_text": "If the rain gauge started out the day already containing 2 inches of rainwater, then the total increase in rainwater in the gauge from 2pm until 9pm is 8+9+1=<<8+9+1=18>>18 inches.‚áíAdding the initial 2 inches, the rain gauge contains 2+18=<<2+18=20>>20 inches of water at 9pm\n#### 20<|endoftext|>",
                        "token_sequence": [
                          2679,
                          279,
                          11174,
                          30890,
                          3855,
                          700,
                          279,
                          1899,
                          2669,
                          8482,
                          220,
                          17,
                          14924,
                          315,
                          11174,
                          12987,
                          11,
                          1221,
                          279,
                          2790,
                          5263,
                          304,
                          11174,
                          12987,
                          304,
                          279,
                          30890,
                          504,
                          220,
                          17,
                          5187,
                          3080,
                          220,
                          24,
                          5187,
                          374,
                          220,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          16,
                          23,
                          2452,
                          16,
                          23,
                          14924,
                          13,
                          144016,
                          32308,
                          279,
                          2856,
                          220,
                          17,
                          14924,
                          11,
                          279,
                          11174,
                          30890,
                          5610,
                          220,
                          17,
                          10,
                          16,
                          23,
                          28,
                          2442,
                          17,
                          10,
                          16,
                          23,
                          28,
                          17,
                          15,
                          2452,
                          17,
                          15,
                          14924,
                          315,
                          3015,
                          518,
                          220,
                          24,
                          5187,
                          198,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[2679, 279, 11174, 30890, 3855...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "id": 6,
        "name": "Node 1",
        "score": "N/A",
        "advantage": "N/A",
        "text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours‚áí",
        "full_text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours‚áí",
        "token_sequence": [
          3830,
          220,
          17,
          5187,
          311,
          220,
          19,
          5187,
          374,
          220,
          19,
          12,
          17,
          28,
          2442,
          19,
          12,
          17,
          28,
          17,
          2452,
          17,
          4115,
          144016
        ],
        "display_tokens": "[3830, 220, 17, 5187, 311, 220...",
        "depth": 1,
        "is_root": false,
        "is_leaf": false,
        "is_first_incorrect": false,
        "children_count": 1,
        "children": [
          {
            "id": 7,
            "name": "Node 2",
            "score": "N/A",
            "advantage": "N/A",
            "text": "If it rained at a rate of 4 inches per hour, then ...",
            "full_text": "If it rained at a rate of 4 inches per hour, then the total",
            "token_sequence": [
              2679,
              432,
              435,
              2627,
              518,
              264,
              4379,
              315,
              220,
              19,
              14924,
              817,
              6460,
              11,
              1221,
              279,
              2790
            ],
            "display_tokens": "[2679, 432, 435, 2627, 518, 26...",
            "depth": 2,
            "is_root": false,
            "is_leaf": false,
            "is_first_incorrect": false,
            "children_count": 1,
            "children": [
              {
                "id": 8,
                "name": "Node 3",
                "score": "N/A",
                "advantage": "N/A",
                "text": " increase in rainwater in the gauge is 4*2=<<4*2=8...",
                "full_text": " increase in rainwater in the gauge is 4*2=<<4*2=8>>8 inches‚áíFrom 4pm to 7pm is 7-4= 3 hours‚áíIf it rained at a rate of 3 inches per hour, then the total increase in rainwater in the gauge is 3*3= <<3*3=9>>9 inches‚áíFrom 7pm to 9pm is 9-7=",
                "token_sequence": [
                  5263,
                  304,
                  11174,
                  12987,
                  304,
                  279,
                  30890,
                  374,
                  220,
                  19,
                  9,
                  17,
                  28,
                  2442,
                  19,
                  9,
                  17,
                  28,
                  23,
                  2452,
                  23,
                  14924,
                  144016,
                  3830,
                  220,
                  19,
                  5187,
                  311,
                  220,
                  22,
                  5187,
                  374,
                  220,
                  22,
                  12,
                  19,
                  28,
                  220,
                  18,
                  4115,
                  144016,
                  2679,
                  432,
                  435,
                  2627,
                  518,
                  264,
                  4379,
                  315,
                  220,
                  18,
                  14924,
                  817,
                  6460,
                  11,
                  1221,
                  279,
                  2790,
                  5263,
                  304,
                  11174,
                  12987,
                  304,
                  279,
                  30890,
                  374,
                  220,
                  18,
                  9,
                  18,
                  28,
                  1115,
                  18,
                  9,
                  18,
                  28,
                  24,
                  2452,
                  24,
                  14924,
                  144016,
                  3830,
                  220,
                  22,
                  5187,
                  311,
                  220,
                  24,
                  5187,
                  374,
                  220,
                  24,
                  12,
                  22,
                  28
                ],
                "display_tokens": "[5263, 304, 11174, 12987, 304,...",
                "depth": 3,
                "is_root": false,
                "is_leaf": false,
                "is_first_incorrect": false,
                "children_count": 1,
                "children": [
                  {
                    "id": 9,
                    "name": "Node 4",
                    "score": "N/A",
                    "advantage": "N/A",
                    "text": "2 hours‚áíIf it rained at a rate of 0.5 inches per h...",
                    "full_text": "2 hours‚áíIf it rained at a rate of 0.5 inches per hour, then the total increase in rainwater in the gauge is 2*0.5=1 inches‚áí",
                    "token_sequence": [
                      17,
                      4115,
                      144016,
                      2679,
                      432,
                      435,
                      2627,
                      518,
                      264,
                      4379,
                      315,
                      220,
                      15,
                      13,
                      20,
                      14924,
                      817,
                      6460,
                      11,
                      1221,
                      279,
                      2790,
                      5263,
                      304,
                      11174,
                      12987,
                      304,
                      279,
                      30890,
                      374,
                      220,
                      17,
                      9,
                      15,
                      13,
                      20,
                      28,
                      16,
                      14924,
                      144016
                    ],
                    "display_tokens": "[17, 4115, 144016, 2679, 432, ...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": false,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 10,
                        "name": "Node 5",
                        "score": 1.0,
                        "advantage": "N/A",
                        "text": "If the rain gauge started out the day already cont...",
                        "full_text": "If the rain gauge started out the day already containing 2 inches of rainwater, then the total is 2+8+9+1=<<2+8+9+1=20>>20 inches\n#### 20<|endoftext|>",
                        "token_sequence": [
                          2679,
                          279,
                          11174,
                          30890,
                          3855,
                          700,
                          279,
                          1899,
                          2669,
                          8482,
                          220,
                          17,
                          14924,
                          315,
                          11174,
                          12987,
                          11,
                          1221,
                          279,
                          2790,
                          374,
                          220,
                          17,
                          10,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          17,
                          10,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          17,
                          15,
                          2452,
                          17,
                          15,
                          14924,
                          198,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[2679, 279, 11174, 30890, 3855...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "id": 11,
        "name": "Node 1",
        "score": "N/A",
        "advantage": "N/A",
        "text": "4pm to 7pm is 4-",
        "full_text": "4pm to 7pm is 4-",
        "token_sequence": [
          19,
          5187,
          311,
          220,
          22,
          5187,
          374,
          220,
          19,
          12
        ],
        "display_tokens": "[19, 5187, 311, 220, 22, 5187,...",
        "depth": 1,
        "is_root": false,
        "is_leaf": false,
        "is_first_incorrect": false,
        "children_count": 1,
        "children": [
          {
            "id": 12,
            "name": "Node 2",
            "score": "N/A",
            "advantage": "N/A",
            "text": "1=<<4-1=3>>3 hours.‚áí",
            "full_text": "1=<<4-1=3>>3 hours.‚áí",
            "token_sequence": [
              16,
              28,
              2442,
              19,
              12,
              16,
              28,
              18,
              2452,
              18,
              4115,
              13,
              144016
            ],
            "display_tokens": "[16, 28, 2442, 19, 12, 16, 28,...",
            "depth": 2,
            "is_root": false,
            "is_leaf": false,
            "is_first_incorrect": false,
            "children_count": 1,
            "children": [
              {
                "id": 13,
                "name": "Node 3",
                "score": "N/A",
                "advantage": "N/A",
                "text": "From 4pm to 7pm, it rained at a rate of 3 inches p...",
                "full_text": "From 4pm to 7pm, it rained at a rate of 3 inches per hour for 3 hours for 3*3=<<3*3=9>>9 inches of rain.‚áí7pm to 9pm is 2 hours.‚áíFrom 7pm to 9pm, it rained at a rate of 0.5 inches per hour for 2 hours for 0.5*2=<<0.5*2=1>>1 inch of rain.‚áí",
                "token_sequence": [
                  3830,
                  220,
                  19,
                  5187,
                  311,
                  220,
                  22,
                  5187,
                  11,
                  432,
                  435,
                  2627,
                  518,
                  264,
                  4379,
                  315,
                  220,
                  18,
                  14924,
                  817,
                  6460,
                  369,
                  220,
                  18,
                  4115,
                  369,
                  220,
                  18,
                  9,
                  18,
                  28,
                  2442,
                  18,
                  9,
                  18,
                  28,
                  24,
                  2452,
                  24,
                  14924,
                  315,
                  11174,
                  13,
                  144016,
                  22,
                  5187,
                  311,
                  220,
                  24,
                  5187,
                  374,
                  220,
                  17,
                  4115,
                  13,
                  144016,
                  3830,
                  220,
                  22,
                  5187,
                  311,
                  220,
                  24,
                  5187,
                  11,
                  432,
                  435,
                  2627,
                  518,
                  264,
                  4379,
                  315,
                  220,
                  15,
                  13,
                  20,
                  14924,
                  817,
                  6460,
                  369,
                  220,
                  17,
                  4115,
                  369,
                  220,
                  15,
                  13,
                  20,
                  9,
                  17,
                  28,
                  2442,
                  15,
                  13,
                  20,
                  9,
                  17,
                  28,
                  16,
                  2452,
                  16,
                  17122,
                  315,
                  11174,
                  13,
                  144016
                ],
                "display_tokens": "[3830, 220, 19, 5187, 311, 220...",
                "depth": 3,
                "is_root": false,
                "is_leaf": false,
                "is_first_incorrect": false,
                "children_count": 5,
                "children": [
                  {
                    "id": 14,
                    "name": "Node 4",
                    "score": 0,
                    "advantage": -0.7303,
                    "text": "Combining all of the rain amounts gives 2+9+1=<<2+...",
                    "full_text": "Combining all of the rain amounts gives 2+9+1=<<2+9+1=12>>12 inches of rain.‚áí",
                    "token_sequence": [
                      36192,
                      5740,
                      678,
                      315,
                      279,
                      11174,
                      14713,
                      6696,
                      220,
                      17,
                      10,
                      24,
                      10,
                      16,
                      28,
                      2442,
                      17,
                      10,
                      24,
                      10,
                      16,
                      28,
                      16,
                      17,
                      2452,
                      16,
                      17,
                      14924,
                      315,
                      11174,
                      13,
                      144016
                    ],
                    "display_tokens": "[36192, 5740, 678, 315, 279, 1...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": true,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 15,
                        "name": "Node 5",
                        "score": 0.0,
                        "advantage": "N/A",
                        "text": "If you start with 2 inches of rain in the gauge an...",
                        "full_text": "If you start with 2 inches of rain in the gauge and you add 12 inches of rain, then by 9pm, the rain gauge will contain 2+12=14 inches of water.\n#### 14<|endoftext|>",
                        "token_sequence": [
                          2679,
                          498,
                          1191,
                          448,
                          220,
                          17,
                          14924,
                          315,
                          11174,
                          304,
                          279,
                          30890,
                          323,
                          498,
                          912,
                          220,
                          16,
                          17,
                          14924,
                          315,
                          11174,
                          11,
                          1221,
                          553,
                          220,
                          24,
                          5187,
                          11,
                          279,
                          11174,
                          30890,
                          686,
                          6644,
                          220,
                          17,
                          10,
                          16,
                          17,
                          28,
                          16,
                          19,
                          14924,
                          315,
                          3015,
                          624,
                          820,
                          220,
                          16,
                          19,
                          151643
                        ],
                        "display_tokens": "[2679, 498, 1191, 448, 220, 17...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  },
                  {
                    "id": 16,
                    "name": "Node 4",
                    "score": 0,
                    "advantage": -0.7303,
                    "text": "Thus, the total amount of rain from 2pm to 9pm is ...",
                    "full_text": "Thus, the total amount of rain from 2pm to 9pm is 4+9+1=<<4+9+1=14>>14 inches‚áíIf you start with 2 inches of water in the gauge and",
                    "token_sequence": [
                      44500,
                      11,
                      279,
                      2790,
                      3311,
                      315,
                      11174,
                      504,
                      220,
                      17,
                      5187,
                      311,
                      220,
                      24,
                      5187,
                      374,
                      220,
                      19,
                      10,
                      24,
                      10,
                      16,
                      28,
                      2442,
                      19,
                      10,
                      24,
                      10,
                      16,
                      28,
                      16,
                      19,
                      2452,
                      16,
                      19,
                      14924,
                      144016,
                      2679,
                      498,
                      1191,
                      448,
                      220,
                      17,
                      14924,
                      315,
                      3015,
                      304,
                      279,
                      30890,
                      323
                    ],
                    "display_tokens": "[44500, 11, 279, 2790, 3311, 3...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": true,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 17,
                        "name": "Node 5",
                        "score": 0.0,
                        "advantage": "N/A",
                        "text": " receive 14 inches of rain, then in the gauge at 9...",
                        "full_text": " receive 14 inches of rain, then in the gauge at 9pm you will have 2+14=<<2+14=16>>16 inches of water.\n#### 16<|endoftext|>",
                        "token_sequence": [
                          5258,
                          220,
                          16,
                          19,
                          14924,
                          315,
                          11174,
                          11,
                          1221,
                          304,
                          279,
                          30890,
                          518,
                          220,
                          24,
                          5187,
                          498,
                          686,
                          614,
                          220,
                          17,
                          10,
                          16,
                          19,
                          28,
                          2442,
                          17,
                          10,
                          16,
                          19,
                          28,
                          16,
                          21,
                          2452,
                          16,
                          21,
                          14924,
                          315,
                          3015,
                          624,
                          820,
                          220,
                          16,
                          21,
                          151643
                        ],
                        "display_tokens": "[5258, 220, 16, 19, 14924, 315...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  },
                  {
                    "id": 18,
                    "name": "Node 4",
                    "score": 0,
                    "advantage": -0.7303,
                    "text": "Up to 9pm, it rained at a rate of 4 inches per hou...",
                    "full_text": "Up to 9pm, it rained at a rate of 4 inches per hour for 4-1=<<3=3>>3 hours for 4*3=<<4*3=12>>12 inches of rain.‚áí",
                    "token_sequence": [
                      2324,
                      311,
                      220,
                      24,
                      5187,
                      11,
                      432,
                      435,
                      2627,
                      518,
                      264,
                      4379,
                      315,
                      220,
                      19,
                      14924,
                      817,
                      6460,
                      369,
                      220,
                      19,
                      12,
                      16,
                      28,
                      2442,
                      18,
                      28,
                      18,
                      2452,
                      18,
                      4115,
                      369,
                      220,
                      19,
                      9,
                      18,
                      28,
                      2442,
                      19,
                      9,
                      18,
                      28,
                      16,
                      17,
                      2452,
                      16,
                      17,
                      14924,
                      315,
                      11174,
                      13,
                      144016
                    ],
                    "display_tokens": "[2324, 311, 220, 24, 5187, 11,...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": true,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 19,
                        "name": "Node 5",
                        "score": 0.0,
                        "advantage": "N/A",
                        "text": "Altogether, the rain gauge will contain 12 + 9 +1 ...",
                        "full_text": "Altogether, the rain gauge will contain 12 + 9 +1 = <<12+9+1=22>>22 inches of water.‚áíAdding the 2 inches that were already in the gauge gives 22 + 2 = <<22+2=24>>24 inches of water in the gauge at 9pm.\n#### 24<|endoftext|>",
                        "token_sequence": [
                          2101,
                          983,
                          3439,
                          11,
                          279,
                          11174,
                          30890,
                          686,
                          6644,
                          220,
                          16,
                          17,
                          488,
                          220,
                          24,
                          488,
                          16,
                          284,
                          1115,
                          16,
                          17,
                          10,
                          24,
                          10,
                          16,
                          28,
                          17,
                          17,
                          2452,
                          17,
                          17,
                          14924,
                          315,
                          3015,
                          13,
                          144016,
                          32308,
                          279,
                          220,
                          17,
                          14924,
                          429,
                          1033,
                          2669,
                          304,
                          279,
                          30890,
                          6696,
                          220,
                          17,
                          17,
                          488,
                          220,
                          17,
                          284,
                          1115,
                          17,
                          17,
                          10,
                          17,
                          28,
                          17,
                          19,
                          2452,
                          17,
                          19,
                          14924,
                          315,
                          3015,
                          304,
                          279,
                          30890,
                          518,
                          220,
                          24,
                          5187,
                          624,
                          820,
                          220,
                          17,
                          19,
                          151643
                        ],
                        "display_tokens": "[2101, 983, 3439, 11, 279, 111...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  },
                  {
                    "id": 20,
                    "name": "Node 4",
                    "score": 1,
                    "advantage": 1.0954,
                    "text": "So from 2pm to 9pm, it rained at a rate of 4 inche...",
                    "full_text": "So from 2pm to 9pm, it rained at a rate of 4 inches per hour for 2 hours, for 4*2=<<4*2=8>>8 inches of rain.‚áí",
                    "token_sequence": [
                      4416,
                      504,
                      220,
                      17,
                      5187,
                      311,
                      220,
                      24,
                      5187,
                      11,
                      432,
                      435,
                      2627,
                      518,
                      264,
                      4379,
                      315,
                      220,
                      19,
                      14924,
                      817,
                      6460,
                      369,
                      220,
                      17,
                      4115,
                      11,
                      369,
                      220,
                      19,
                      9,
                      17,
                      28,
                      2442,
                      19,
                      9,
                      17,
                      28,
                      23,
                      2452,
                      23,
                      14924,
                      315,
                      11174,
                      13,
                      144016
                    ],
                    "display_tokens": "[4416, 504, 220, 17, 5187, 311...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": false,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 21,
                        "name": "Node 5",
                        "score": 1.0,
                        "advantage": "N/A",
                        "text": "So, including the water that was already in the ga...",
                        "full_text": "So, including the water that was already in the gauge, the total is 8+9+1+2=<<8+9+1+2=20>>20 inches of water in the gauge at 9pm.\n#### 20<|endoftext|>",
                        "token_sequence": [
                          4416,
                          11,
                          2670,
                          279,
                          3015,
                          429,
                          572,
                          2669,
                          304,
                          279,
                          30890,
                          11,
                          279,
                          2790,
                          374,
                          220,
                          23,
                          10,
                          24,
                          10,
                          16,
                          10,
                          17,
                          28,
                          2442,
                          23,
                          10,
                          24,
                          10,
                          16,
                          10,
                          17,
                          28,
                          17,
                          15,
                          2452,
                          17,
                          15,
                          14924,
                          315,
                          3015,
                          304,
                          279,
                          30890,
                          518,
                          220,
                          24,
                          5187,
                          624,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[4416, 11, 2670, 279, 3015, 42...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  },
                  {
                    "id": 22,
                    "name": "Node 4",
                    "score": 1,
                    "advantage": 1.0954,
                    "text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours.‚áíFrom 2pm ...",
                    "full_text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours.‚áíFrom 2pm to 4pm, it rained at a rate of 4 inches per hour for 2 hours for 4*2=<<4*2=8>>8 inches of rain.‚áí",
                    "token_sequence": [
                      3830,
                      220,
                      17,
                      5187,
                      311,
                      220,
                      19,
                      5187,
                      374,
                      220,
                      19,
                      12,
                      17,
                      28,
                      2442,
                      19,
                      12,
                      17,
                      28,
                      17,
                      2452,
                      17,
                      4115,
                      13,
                      144016,
                      3830,
                      220,
                      17,
                      5187,
                      311,
                      220,
                      19,
                      5187,
                      11,
                      432,
                      435,
                      2627,
                      518,
                      264,
                      4379,
                      315,
                      220,
                      19,
                      14924,
                      817,
                      6460,
                      369,
                      220,
                      17,
                      4115,
                      369,
                      220,
                      19,
                      9,
                      17,
                      28,
                      2442,
                      19,
                      9,
                      17,
                      28,
                      23,
                      2452,
                      23,
                      14924,
                      315,
                      11174,
                      13,
                      144016
                    ],
                    "display_tokens": "[3830, 220, 17, 5187, 311, 220...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": false,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 23,
                        "name": "Node 5",
                        "score": 1.0,
                        "advantage": "N/A",
                        "text": "With the initial 2 inches, by 9pm there will be 2+...",
                        "full_text": "With the initial 2 inches, by 9pm there will be 2+8+9+1=<<2+8+9+1=20>>20 inches of rain in the gauge.\n#### 20<|endoftext|>",
                        "token_sequence": [
                          2354,
                          279,
                          2856,
                          220,
                          17,
                          14924,
                          11,
                          553,
                          220,
                          24,
                          5187,
                          1052,
                          686,
                          387,
                          220,
                          17,
                          10,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          17,
                          10,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          17,
                          15,
                          2452,
                          17,
                          15,
                          14924,
                          315,
                          11174,
                          304,
                          279,
                          30890,
                          624,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[2354, 279, 2856, 220, 17, 149...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "id": 24,
        "name": "Node 1",
        "score": "N/A",
        "advantage": "N/A",
        "text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours.‚áí",
        "full_text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours.‚áí",
        "token_sequence": [
          3830,
          220,
          17,
          5187,
          311,
          220,
          19,
          5187,
          374,
          220,
          19,
          12,
          17,
          28,
          2442,
          19,
          12,
          17,
          28,
          17,
          2452,
          17,
          4115,
          13,
          144016
        ],
        "display_tokens": "[3830, 220, 17, 5187, 311, 220...",
        "depth": 1,
        "is_root": false,
        "is_leaf": false,
        "is_first_incorrect": false,
        "children_count": 1,
        "children": [
          {
            "id": 25,
            "name": "Node 2",
            "score": "N/A",
            "advantage": "N/A",
            "text": "If it rained at a rate of 4 inches per hour, then ...",
            "full_text": "If it rained at a rate of 4 inches per hour, then the total",
            "token_sequence": [
              2679,
              432,
              435,
              2627,
              518,
              264,
              4379,
              315,
              220,
              19,
              14924,
              817,
              6460,
              11,
              1221,
              279,
              2790
            ],
            "display_tokens": "[2679, 432, 435, 2627, 518, 26...",
            "depth": 2,
            "is_root": false,
            "is_leaf": false,
            "is_first_incorrect": false,
            "children_count": 1,
            "children": [
              {
                "id": 26,
                "name": "Node 3",
                "score": "N/A",
                "advantage": "N/A",
                "text": " increase in rainwater in the gauge is 4*2=8 inche...",
                "full_text": " increase in rainwater in the gauge is 4*2=8 inches.‚áíFrom 4pm to 7pm is 7-4=<<7-4=3>>3 hours.‚áíIf it rained at a rate of 3 inches per hour, then the total increase in rainwater in the gauge is 3*3=<<3*3=9>>9 inches.‚áíFrom 7pm to 9pm is 9-7=<<9-7=2>>2 hour‚áíIf it rained at a rate of 0.5 inches per hour, then the total increase in rainwater in the gauge is 2*0.5=<<2*0.5=1>>1 inch.‚áí",
                "token_sequence": [
                  5263,
                  304,
                  11174,
                  12987,
                  304,
                  279,
                  30890,
                  374,
                  220,
                  19,
                  9,
                  17,
                  28,
                  23,
                  14924,
                  13,
                  144016,
                  3830,
                  220,
                  19,
                  5187,
                  311,
                  220,
                  22,
                  5187,
                  374,
                  220,
                  22,
                  12,
                  19,
                  28,
                  2442,
                  22,
                  12,
                  19,
                  28,
                  18,
                  2452,
                  18,
                  4115,
                  13,
                  144016,
                  2679,
                  432,
                  435,
                  2627,
                  518,
                  264,
                  4379,
                  315,
                  220,
                  18,
                  14924,
                  817,
                  6460,
                  11,
                  1221,
                  279,
                  2790,
                  5263,
                  304,
                  11174,
                  12987,
                  304,
                  279,
                  30890,
                  374,
                  220,
                  18,
                  9,
                  18,
                  28,
                  2442,
                  18,
                  9,
                  18,
                  28,
                  24,
                  2452,
                  24,
                  14924,
                  13,
                  144016,
                  3830,
                  220,
                  22,
                  5187,
                  311,
                  220,
                  24,
                  5187,
                  374,
                  220,
                  24,
                  12,
                  22,
                  28,
                  2442,
                  24,
                  12,
                  22,
                  28,
                  17,
                  2452,
                  17,
                  6460,
                  144016,
                  2679,
                  432,
                  435,
                  2627,
                  518,
                  264,
                  4379,
                  315,
                  220,
                  15,
                  13,
                  20,
                  14924,
                  817,
                  6460,
                  11,
                  1221,
                  279,
                  2790,
                  5263,
                  304,
                  11174,
                  12987,
                  304,
                  279,
                  30890,
                  374,
                  220,
                  17,
                  9,
                  15,
                  13,
                  20,
                  28,
                  2442,
                  17,
                  9,
                  15,
                  13,
                  20,
                  28,
                  16,
                  2452,
                  16,
                  17122,
                  13,
                  144016
                ],
                "display_tokens": "[5263, 304, 11174, 12987, 304,...",
                "depth": 3,
                "is_root": false,
                "is_leaf": false,
                "is_first_incorrect": false,
                "children_count": 1,
                "children": [
                  {
                    "id": 27,
                    "name": "Node 4",
                    "score": "N/A",
                    "advantage": "N/A",
                    "text": "The rain began the day at 2 inches,",
                    "full_text": "The rain began the day at 2 inches,",
                    "token_sequence": [
                      785,
                      11174,
                      6009,
                      279,
                      1899,
                      518,
                      220,
                      17,
                      14924,
                      11
                    ],
                    "display_tokens": "[785, 11174, 6009, 279, 1899, ...",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": false,
                    "children_count": 5,
                    "children": [
                      {
                        "id": 28,
                        "name": "Node 5",
                        "score": 0,
                        "advantage": -0.7303,
                        "text": " and the total increase in rainwater of 8+9+1=<<2+...",
                        "full_text": " and the total increase in rainwater of 8+9+1=<<2+9+1=12>>12 inches‚áíThus, at 9pm the gauge will contain 2+12=<<2+12=14>>14 inches of water.\n#### 14<|endoftext|>",
                        "token_sequence": [
                          323,
                          279,
                          2790,
                          5263,
                          304,
                          11174,
                          12987,
                          315,
                          220,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          17,
                          10,
                          24,
                          10,
                          16,
                          28,
                          16,
                          17,
                          2452,
                          16,
                          17,
                          14924,
                          144016,
                          44500,
                          11,
                          518,
                          220,
                          24,
                          5187,
                          279,
                          30890,
                          686,
                          6644,
                          220,
                          17,
                          10,
                          16,
                          17,
                          28,
                          2442,
                          17,
                          10,
                          16,
                          17,
                          28,
                          16,
                          19,
                          2452,
                          16,
                          19,
                          14924,
                          315,
                          3015,
                          624,
                          820,
                          220,
                          16,
                          19,
                          151643
                        ],
                        "display_tokens": "[323, 279, 2790, 5263, 304, 11...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": true,
                        "children_count": 0,
                        "children": []
                      },
                      {
                        "id": 29,
                        "name": "Node 5",
                        "score": 1,
                        "advantage": 1.0954,
                        "text": " then had 8 inches added, 9 more inches added, for...",
                        "full_text": " then had 8 inches added, 9 more inches added, for a total of 2+8+9=<<2+8+9=19>>19 inches.‚áíThen one more inch was added for a total of 19+1=<<19+1=20>>20 inches in the gauge at 9pm.\n#### 20<|endoftext|>",
                        "token_sequence": [
                          1221,
                          1030,
                          220,
                          23,
                          14924,
                          3694,
                          11,
                          220,
                          24,
                          803,
                          14924,
                          3694,
                          11,
                          369,
                          264,
                          2790,
                          315,
                          220,
                          17,
                          10,
                          23,
                          10,
                          24,
                          28,
                          2442,
                          17,
                          10,
                          23,
                          10,
                          24,
                          28,
                          16,
                          24,
                          2452,
                          16,
                          24,
                          14924,
                          13,
                          144016,
                          12209,
                          825,
                          803,
                          17122,
                          572,
                          3694,
                          369,
                          264,
                          2790,
                          315,
                          220,
                          16,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          16,
                          24,
                          10,
                          16,
                          28,
                          17,
                          15,
                          2452,
                          17,
                          15,
                          14924,
                          304,
                          279,
                          30890,
                          518,
                          220,
                          24,
                          5187,
                          624,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[1221, 1030, 220, 23, 14924, 3...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      },
                      {
                        "id": 30,
                        "name": "Node 5",
                        "score": 0,
                        "advantage": -0.7303,
                        "text": " and the total increase in rainwater levels in the...",
                        "full_text": " and the total increase in rainwater levels in the gauge throughout the day is 8+9+1=<<2+9+1=12>>12 inches.‚áíThus, at 9pm the gauge will contain 12+2= <<12+2=14>>14 inches of water.\n#### 14<|endoftext|>",
                        "token_sequence": [
                          323,
                          279,
                          2790,
                          5263,
                          304,
                          11174,
                          12987,
                          5866,
                          304,
                          279,
                          30890,
                          6814,
                          279,
                          1899,
                          374,
                          220,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          17,
                          10,
                          24,
                          10,
                          16,
                          28,
                          16,
                          17,
                          2452,
                          16,
                          17,
                          14924,
                          13,
                          144016,
                          44500,
                          11,
                          518,
                          220,
                          24,
                          5187,
                          279,
                          30890,
                          686,
                          6644,
                          220,
                          16,
                          17,
                          10,
                          17,
                          28,
                          1115,
                          16,
                          17,
                          10,
                          17,
                          28,
                          16,
                          19,
                          2452,
                          16,
                          19,
                          14924,
                          315,
                          3015,
                          624,
                          820,
                          220,
                          16,
                          19,
                          151643
                        ],
                        "display_tokens": "[323, 279, 2790, 5263, 304, 11...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": true,
                        "children_count": 0,
                        "children": []
                      },
                      {
                        "id": 31,
                        "name": "Node 5",
                        "score": 1,
                        "advantage": 1.0954,
                        "text": " and then had 8 inches of rain added between 2pm a...",
                        "full_text": " and then had 8 inches of rain added between 2pm and 4pm, 9 inches added from 4pm to 7pm, and 1 inch added from 7pm to 9pm. The total amount of rain in the gauge at 9pm is 2+8+9+1=Ôºú20=20 inches.\n#### 20<|endoftext|>",
                        "token_sequence": [
                          323,
                          1221,
                          1030,
                          220,
                          23,
                          14924,
                          315,
                          11174,
                          3694,
                          1948,
                          220,
                          17,
                          5187,
                          323,
                          220,
                          19,
                          5187,
                          11,
                          220,
                          24,
                          14924,
                          3694,
                          504,
                          220,
                          19,
                          5187,
                          311,
                          220,
                          22,
                          5187,
                          11,
                          323,
                          220,
                          16,
                          17122,
                          3694,
                          504,
                          220,
                          22,
                          5187,
                          311,
                          220,
                          24,
                          5187,
                          13,
                          576,
                          2790,
                          3311,
                          315,
                          11174,
                          304,
                          279,
                          30890,
                          518,
                          220,
                          24,
                          5187,
                          374,
                          220,
                          17,
                          10,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          137573,
                          17,
                          15,
                          28,
                          17,
                          15,
                          14924,
                          624,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[323, 1221, 1030, 220, 23, 149...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      },
                      {
                        "id": 32,
                        "name": "Node 5",
                        "score": 0,
                        "advantage": -0.7303,
                        "text": " and the total increase in rainwater of 8+9+1=<<2+...",
                        "full_text": " and the total increase in rainwater of 8+9+1=<<2+9+1=12>>12 inches‚áíThus, by 9pm, the gauge would contain 12+2=<<12+2=14>>14 inches of water.\n#### 14<|endoftext|>",
                        "token_sequence": [
                          323,
                          279,
                          2790,
                          5263,
                          304,
                          11174,
                          12987,
                          315,
                          220,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          17,
                          10,
                          24,
                          10,
                          16,
                          28,
                          16,
                          17,
                          2452,
                          16,
                          17,
                          14924,
                          144016,
                          44500,
                          11,
                          553,
                          220,
                          24,
                          5187,
                          11,
                          279,
                          30890,
                          1035,
                          6644,
                          220,
                          16,
                          17,
                          10,
                          17,
                          28,
                          2442,
                          16,
                          17,
                          10,
                          17,
                          28,
                          16,
                          19,
                          2452,
                          16,
                          19,
                          14924,
                          315,
                          3015,
                          624,
                          820,
                          220,
                          16,
                          19,
                          151643
                        ],
                        "display_tokens": "[323, 279, 2790, 5263, 304, 11...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": true,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "id": 33,
        "name": "Node 1",
        "score": "N/A",
        "advantage": "N/A",
        "text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours‚áíIf it rain...",
        "full_text": "From 2pm to 4pm is 4-2=<<4-2=2>>2 hours‚áíIf it rained at a rate of 4 inches per hour, then the total",
        "token_sequence": [
          3830,
          220,
          17,
          5187,
          311,
          220,
          19,
          5187,
          374,
          220,
          19,
          12,
          17,
          28,
          2442,
          19,
          12,
          17,
          28,
          17,
          2452,
          17,
          4115,
          144016,
          2679,
          432,
          435,
          2627,
          518,
          264,
          4379,
          315,
          220,
          19,
          14924,
          817,
          6460,
          11,
          1221,
          279,
          2790
        ],
        "display_tokens": "[3830, 220, 17, 5187, 311, 220...",
        "depth": 1,
        "is_root": false,
        "is_leaf": false,
        "is_first_incorrect": false,
        "children_count": 1,
        "children": [
          {
            "id": 34,
            "name": "Node 2",
            "score": "N/A",
            "advantage": "N/A",
            "text": " increase in rainwater in the gauge is 4*2=<<8=8>>...",
            "full_text": " increase in rainwater in the gauge is 4*2=<<8=8>>8 inches‚áíFrom 4pm to 7pm is 7-4=<<7-4=3>>3 hours‚áíIf it rained at a rate of 3 inches per hour, then the total increase in rainwater in the gauge is 3*3=<<3*3=9>>9 inches‚áíFrom 7pm to 9pm is 9-7=<<9-7=2>>2 hours‚áíIf it rained at a rate of 0.5 inches per hour, then the total increase in rainwater in the gauge is 0.5*2=<<0.5*2=1>>1 inch‚áí",
            "token_sequence": [
              5263,
              304,
              11174,
              12987,
              304,
              279,
              30890,
              374,
              220,
              19,
              9,
              17,
              28,
              2442,
              23,
              28,
              23,
              2452,
              23,
              14924,
              144016,
              3830,
              220,
              19,
              5187,
              311,
              220,
              22,
              5187,
              374,
              220,
              22,
              12,
              19,
              28,
              2442,
              22,
              12,
              19,
              28,
              18,
              2452,
              18,
              4115,
              144016,
              2679,
              432,
              435,
              2627,
              518,
              264,
              4379,
              315,
              220,
              18,
              14924,
              817,
              6460,
              11,
              1221,
              279,
              2790,
              5263,
              304,
              11174,
              12987,
              304,
              279,
              30890,
              374,
              220,
              18,
              9,
              18,
              28,
              2442,
              18,
              9,
              18,
              28,
              24,
              2452,
              24,
              14924,
              144016,
              3830,
              220,
              22,
              5187,
              311,
              220,
              24,
              5187,
              374,
              220,
              24,
              12,
              22,
              28,
              2442,
              24,
              12,
              22,
              28,
              17,
              2452,
              17,
              4115,
              144016,
              2679,
              432,
              435,
              2627,
              518,
              264,
              4379,
              315,
              220,
              15,
              13,
              20,
              14924,
              817,
              6460,
              11,
              1221,
              279,
              2790,
              5263,
              304,
              11174,
              12987,
              304,
              279,
              30890,
              374,
              220,
              15,
              13,
              20,
              9,
              17,
              28,
              2442,
              15,
              13,
              20,
              9,
              17,
              28,
              16,
              2452,
              16,
              17122,
              144016
            ],
            "display_tokens": "[5263, 304, 11174, 12987, 304,...",
            "depth": 2,
            "is_root": false,
            "is_leaf": false,
            "is_first_incorrect": false,
            "children_count": 1,
            "children": [
              {
                "id": 35,
                "name": "Node 3",
                "score": "N/A",
                "advantage": "N/A",
                "text": "Adding up the increases",
                "full_text": "Adding up the increases",
                "token_sequence": [
                  32308,
                  705,
                  279,
                  12703
                ],
                "display_tokens": "[32308, 705, 279, 12703]",
                "depth": 3,
                "is_root": false,
                "is_leaf": false,
                "is_first_incorrect": false,
                "children_count": 1,
                "children": [
                  {
                    "id": 36,
                    "name": "Node 4",
                    "score": "N/A",
                    "advantage": "N/A",
                    "text": " in rainwater",
                    "full_text": " in rainwater",
                    "token_sequence": [
                      304,
                      11174,
                      12987
                    ],
                    "display_tokens": "[304, 11174, 12987]",
                    "depth": 4,
                    "is_root": false,
                    "is_leaf": false,
                    "is_first_incorrect": false,
                    "children_count": 1,
                    "children": [
                      {
                        "id": 37,
                        "name": "Node 5",
                        "score": 1.0,
                        "advantage": "N/A",
                        "text": " in the gauge, we get 8+9+1=<<8+9+1=18>>18 inches‚áí...",
                        "full_text": " in the gauge, we get 8+9+1=<<8+9+1=18>>18 inches‚áíIf the rain gauge started out the day already containing 2 inches of rainwater, then by 9pm, it will contain 2+18=<<2+18=20>>20 inches of water\n#### 20<|endoftext|>",
                        "token_sequence": [
                          304,
                          279,
                          30890,
                          11,
                          582,
                          633,
                          220,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          2442,
                          23,
                          10,
                          24,
                          10,
                          16,
                          28,
                          16,
                          23,
                          2452,
                          16,
                          23,
                          14924,
                          144016,
                          2679,
                          279,
                          11174,
                          30890,
                          3855,
                          700,
                          279,
                          1899,
                          2669,
                          8482,
                          220,
                          17,
                          14924,
                          315,
                          11174,
                          12987,
                          11,
                          1221,
                          553,
                          220,
                          24,
                          5187,
                          11,
                          432,
                          686,
                          6644,
                          220,
                          17,
                          10,
                          16,
                          23,
                          28,
                          2442,
                          17,
                          10,
                          16,
                          23,
                          28,
                          17,
                          15,
                          2452,
                          17,
                          15,
                          14924,
                          315,
                          3015,
                          198,
                          820,
                          220,
                          17,
                          15,
                          151643
                        ],
                        "display_tokens": "[304, 279, 30890, 11, 582, 633...",
                        "depth": 5,
                        "is_root": false,
                        "is_leaf": true,
                        "is_first_incorrect": false,
                        "children_count": 0,
                        "children": []
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  "meta_info": {
    "final_answer": "20",
    "total_nodes": 38,
    "max_depth": 5,
    "order": 5
  }
};
        
        let root = treeData.tree_data;
        const metaInfo = treeData.meta_info;
        let currentActiveNode = null; // Ë∑üË∏™ÂΩìÂâçÊ¥ªË∑ÉÁöÑËäÇÁÇπ
        
        // Âä®ÊÄÅËÆ°ÁÆóÂÆπÂô®Â∞∫ÂØ∏
        function getContainerDimensions() {
            const container = document.getElementById('tree-container');
            const rect = container.getBoundingClientRect();
            return {
                width: rect.width,
                height: rect.height
            };
        }
        
        // ËÆ°ÁÆóÊ†ëÁöÑÂÆûÈôÖÈúÄË¶ÅÂ∞∫ÂØ∏ÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºâ
        function calculateTreeDimensions(root) {
            const nodeCount = root.descendants().length;
            const maxDepth = root.height;
            
            // Ê†πÊçÆËäÇÁÇπÊï∞ÈáèÂíåÊ∑±Â∫¶ËÆ°ÁÆóÂêàÈÄÇÁöÑÂ∞∫ÂØ∏ÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºâ
            const minWidth = Math.max(800, nodeCount * 60 + 400);
            const minHeight = Math.max(600, maxDepth * 180 + 200);
            
            return { width: minWidth, height: minHeight };
        }
        
        // ÂàùÂßãÂåñSVGÂ∞∫ÂØ∏
        function initializeSVG() {
            const containerDims = getContainerDimensions();
            const margin = {top: 40, right: 150, bottom: 40, left: 150};
            
            // Á°Æ‰øùSVGËá≥Â∞ëÂ°´Êª°ÂÆπÂô®
            const width = Math.max(containerDims.width - margin.left - margin.right, 600);
            const height = Math.max(containerDims.height - margin.top - margin.bottom, 400);
            
            const svg = d3.select("#tree-svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);
            
            return { svg, width, height, margin };
        }
        
        // ÈáçÊñ∞ÂàùÂßãÂåñ
        let { svg, width, height, margin } = initializeSVG();
        
        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // Áº©ÊîæÂíåÊãñÊãΩ
        const zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
                // Â¶ÇÊûúÊúâÊøÄÊ¥ªÁöÑtooltipÔºåÈúÄË¶ÅÊõ¥Êñ∞ÂÖ∂‰ΩçÁΩÆ
                if (currentActiveNode) {
                    updateTooltipPosition(currentActiveNode);
                }
            });
        
        svg.call(zoom);
        
        // Ê†ëÂ∏ÉÂ±ÄÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºö‰∫§Êç¢widthÂíåheightÔºâ
        let treemap = d3.tree().size([width, height]);
        
        // ÂàõÂª∫Ê†πËäÇÁÇπ - ÊâÄÊúâËäÇÁÇπÈÉΩÂ±ïÂºÄ
        root = d3.hierarchy(root, d => d.children);
        root.x0 = width / 2;
        root.y0 = 0;
        
        // Âä®ÊÄÅË∞ÉÊï¥SVGÂ∞∫ÂØ∏
        function adjustSVGSize() {
            const treeDims = calculateTreeDimensions(root);
            const containerDims = getContainerDimensions();
            
            // ‰ΩøÁî®ËæÉÂ§ßÁöÑÂ∞∫ÂØ∏‰ª•Á°Æ‰øùÊ†ëÂÆåÂÖ®ÂèØËßÅ
            const newWidth = Math.max(treeDims.width, containerDims.width - margin.left - margin.right);
            const newHeight = Math.max(treeDims.height, containerDims.height - margin.top - margin.bottom);
            
            svg.attr("width", newWidth + margin.left + margin.right)
               .attr("height", newHeight + margin.top + margin.bottom);
            
            // Êõ¥Êñ∞Ê†ëÂ∏ÉÂ±ÄÂ∞∫ÂØ∏ÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºâ
            treemap.size([newWidth, newHeight]);
            
            return { width: newWidth, height: newHeight };
        }
        
        // Âú®Ê†ëÂÆπÂô®ÂÜÖÂàõÂª∫tooltip
        const tooltip = d3.select("#tree-container").append("div")
            .attr("class", "tooltip");
        
        // ‰øÆÊîπÂêéÁöÑÊñáÊú¨Ê†ºÂºèÂåñÂáΩÊï∞ - ËÆ©ËΩ¨‰πâÂ≠óÁ¨¶ÂèØËßÅ‰ΩÜ‰∏çÊâßË°å
        function formatTextForDisplay(text) {
            if (!text) return 'N/A';
            
            // Â¶ÇÊûúÊñáÊú¨‰∏≠ÂåÖÂê´ÁöÑÊòØÂÆûÈôÖÁöÑÊç¢Ë°åÁ¨¶„ÄÅÂà∂Ë°®Á¨¶Á≠âÔºåÂ∞ÜÂÆÉ‰ª¨ËΩ¨Êç¢‰∏∫ÂèØËßÅÁöÑËΩ¨‰πâÂ≠óÁ¨¶
            // Â¶ÇÊûúÊñáÊú¨‰∏≠Â∑≤ÁªèÊòØ \n ËøôÊ†∑ÁöÑÂ≠óÁ¨¶‰∏≤ÔºåÂàô‰øùÊåÅ‰∏çÂèò
            return text
                .replace(/\\/g, '\\\\')
                .replace(/\n/g, '\\n')         // Êç¢Ë°åÁ¨¶ÊòæÁ§∫‰∏∫ \n
                .replace(/\t/g, '\\t')         // Âà∂Ë°®Á¨¶ÊòæÁ§∫‰∏∫ \t
                .replace(/\r/g, '\\r')        // ÂõûËΩ¶Á¨¶ÊòæÁ§∫‰∏∫ \r
        }

        // Ê†ºÂºèÂåñ tooltip ÂÜÖÂÆπ - ÁÇπÂáªÁâàÊú¨
        function formatTooltipContent(d) {
            const data = d.data;
            
            // ÂàõÂª∫tooltipÂÆπÂô®
            const tooltipDiv = document.createElement('div');
            
            // ÂàõÂª∫headerÈÉ®ÂàÜÔºåÂåÖÂê´ÂÖ≥Èó≠ÊåâÈíÆ
            const header = document.createElement('div');
            header.className = 'tooltip-header';
            
            const title = document.createElement('span');
            title.textContent = data.name;
            
            const closeButton = document.createElement('button');
            closeButton.className = 'tooltip-close';
            closeButton.innerHTML = '√ó';
            closeButton.type = 'button';
            // Áõ¥Êé•ÁªëÂÆö‰∫ã‰ª∂Â§ÑÁêÜÂô®
            closeButton.addEventListener('click', function(e) {
                e.stopPropagation();
                closeTooltip();
            });
            
            header.appendChild(title);
            header.appendChild(closeButton);
            tooltipDiv.appendChild(header);
            
            // Ê∑ªÂä†ÂêÑ‰∏™‰ø°ÊÅØÊÆµ
            const sections = [
                { label: 'Node ID', value: data.id },
                { label: 'Score', value: data.score },
                { label: 'Advantage', value: data.advantage },
                { label: 'Depth', value: data.depth },
                { label: 'Children Count', value: data.children_count },
                { label: 'Is First Incorrect', value: data.is_first_incorrect }
            ];
            
            sections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'tooltip-section';
                
                const label = document.createElement('span');
                label.className = 'tooltip-label';
                label.textContent = section.label;
                
                const value = document.createElement('div');
                value.className = 'tooltip-value';
                value.textContent = section.value;
                
                sectionDiv.appendChild(label);
                sectionDiv.appendChild(value);
                tooltipDiv.appendChild(sectionDiv);
            });
            
            // Full Text ÈÉ®ÂàÜ - ‰ΩøÁî®‰øÆÊîπÂêéÁöÑÊ†ºÂºèÂåñÂáΩÊï∞
            const textSection = document.createElement('div');
            textSection.className = 'tooltip-section';
            
            const textLabel = document.createElement('span');
            textLabel.className = 'tooltip-label';
            textLabel.textContent = 'Full Text';
            
            const textValue = document.createElement('div');
            textValue.className = 'tooltip-text';
            // ‰ΩøÁî®‰øÆÊîπÂêéÁöÑÊ†ºÂºèÂåñÂáΩÊï∞
            textValue.textContent = formatTextForDisplay(data.full_text);
            
            textSection.appendChild(textLabel);
            textSection.appendChild(textValue);
            tooltipDiv.appendChild(textSection);
            
            // Token Sequence ÈÉ®ÂàÜ
            const tokenSection = document.createElement('div');
            tokenSection.className = 'tooltip-section';
            
            const tokenLabel = document.createElement('span');
            tokenLabel.className = 'tooltip-label';
            tokenLabel.textContent = 'Token Sequence';
            
            const tokenValue = document.createElement('div');
            tokenValue.className = 'tooltip-tokens';
            tokenValue.textContent = JSON.stringify(data.token_sequence, null, 2);
            
            tokenSection.appendChild(tokenLabel);
            tokenSection.appendChild(tokenValue);
            tooltipDiv.appendChild(tokenSection);
            
            return tooltipDiv;
        }
        
        // Ëé∑ÂèñËäÇÁÇπÂú®ÂÆπÂô®‰∏≠ÁöÑÂÆûÈôÖ‰ΩçÁΩÆÔºàÂûÇÁõ¥Â∏ÉÂ±ÄË∞ÉÊï¥Ôºâ
        function getNodePosition(d) {
            // Ëé∑ÂèñÂΩìÂâçÁöÑÁº©ÊîæÂèòÊç¢
            const transform = d3.zoomTransform(svg.node());
            
            // ËÆ°ÁÆóËäÇÁÇπÂú®ÂèòÊç¢ÂêéÁöÑ‰ΩçÁΩÆÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºöxÂíåyÂØπÂ∫îÂÖ≥Á≥ªË∞ÉÊï¥Ôºâ
            const x = (d.x + margin.left) * transform.k + transform.x;
            const y = (d.y + margin.top) * transform.k + transform.y;
            
            return { x, y };
        }
        
        // ËÆ°ÁÆótooltipÁöÑÊúÄ‰Ω≥‰ΩçÁΩÆ
        function calculateTooltipPosition(nodePos, tooltipWidth, tooltipHeight) {
            const container = document.getElementById('tree-container');
            const containerRect = container.getBoundingClientRect();
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            let x, y;
            const offset = 15; // Ë∑ùÁ¶ªËäÇÁÇπÁöÑÂÅèÁßªÈáè
            
            // ÈªòËÆ§‰ΩçÁΩÆÔºöËäÇÁÇπÂè≥‰æß
            x = nodePos.x + offset;
            y = nodePos.y - tooltipHeight / 2;
            
            // Ê£ÄÊü•Âè≥‰æßÊòØÂê¶Ë∂ÖÂá∫ËæπÁïå
            if (x + tooltipWidth > containerWidth) {
                // Â∞ùËØïÂ∑¶‰æß
                x = nodePos.x - tooltipWidth - offset;
            }
            
            // Ê£ÄÊü•Â∑¶‰æßÊòØÂê¶Ë∂ÖÂá∫ËæπÁïå
            if (x < 0) {
                // Â¶ÇÊûúÂ∑¶Âè≥ÈÉΩ‰∏çË°åÔºåÊîæÂú®ËäÇÁÇπ‰∏ãÊñπ
                x = nodePos.x - tooltipWidth / 2;
                y = nodePos.y + offset;
                
                // Â¶ÇÊûú‰∏ãÊñπ‰πüË∂ÖÂá∫ÔºåÊîæÂú®‰∏äÊñπ
                if (y + tooltipHeight > containerHeight) {
                    y = nodePos.y - tooltipHeight - offset;
                }
            }
            
            // ÊúÄÁªàËæπÁïåÊ£ÄÊü•
            x = Math.max(5, Math.min(x, containerWidth - tooltipWidth - 5));
            y = Math.max(5, Math.min(y, containerHeight - tooltipHeight - 5));
            
            return { x, y };
        }
        
        // Êõ¥Êñ∞tooltip‰ΩçÁΩÆ
        function updateTooltipPosition(d) {
            if (!tooltip.classed("show")) return;
            
            const nodePos = getNodePosition(d);
            const tooltipNode = tooltip.node();
            const tooltipRect = tooltipNode.getBoundingClientRect();
            
            const position = calculateTooltipPosition(
                nodePos, 
                tooltipRect.width || 350, 
                tooltipRect.height || 400
            );
            
            tooltip.style("left", position.x + "px")
                   .style("top", position.y + "px");
        }
        
        // ÊòæÁ§∫tooltip
        function showTooltip(d, event) {
            // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂêå‰∏Ä‰∏™ËäÇÁÇπÔºåÂàôÂÖ≥Èó≠tooltip
            if (currentActiveNode === d) {
                closeTooltip();
                return;
            }
            
            // ÂÖ≥Èó≠‰πãÂâçÁöÑtooltipÂπ∂ÁßªÈô§‰πãÂâçÁöÑÈ´ò‰∫Æ
            if (currentActiveNode) {
                removeActiveState(currentActiveNode);
            }
            
            // ËÆæÁΩÆÊñ∞ÁöÑÊ¥ªË∑ÉËäÇÁÇπ
            currentActiveNode = d;
            
            // Ê∑ªÂä†Ê¥ªË∑ÉÁä∂ÊÄÅ
            addActiveState(d);
            
            // ÂàõÂª∫tooltipÂÜÖÂÆπÂπ∂Áõ¥Êé•Ê∑ªÂä†Âà∞DOM
            const tooltipContent = formatTooltipContent(d);
            tooltip.node().innerHTML = '';
            tooltip.node().appendChild(tooltipContent);
            
            // ÊòæÁ§∫tooltipÔºàÂÖàÊòæÁ§∫‰ª•Ëé∑ÂèñÂ∞∫ÂØ∏Ôºâ
            tooltip.classed("show", true);
            
            // ËÆ°ÁÆóÂπ∂ËÆæÁΩÆtooltip‰ΩçÁΩÆ
            setTimeout(() => {
                updateTooltipPosition(d);
            }, 0);
            
            // È´ò‰∫ÆË∑ØÂæÑ
            highlightPath(d);
        }
        
        // ÂÖ≥Èó≠tooltip
        function closeTooltip() {
            tooltip.classed("show", false);
            
            if (currentActiveNode) {
                removeActiveState(currentActiveNode);
                currentActiveNode = null;
            }
            
            // ÁßªÈô§È´ò‰∫Æ
            removeHighlight();
        }
        
        // Ê∑ªÂä†Ê¥ªË∑ÉÁä∂ÊÄÅ
        function addActiveState(node) {
            g.selectAll('g.node')
                .classed('active', d => d === node);
        }
        
        // ÁßªÈô§Ê¥ªË∑ÉÁä∂ÊÄÅ
        function removeActiveState(node) {
            g.selectAll('g.node')
                .classed('active', false);
        }
        
        // Êõ¥Êñ∞Ê†ë
        function update(source) {
            // Ë∞ÉÊï¥SVGÂ∞∫ÂØ∏
            const dims = adjustSVGSize();
            
            const treeData = treemap(root);
            const nodes = treeData.descendants();
            const links = treeData.descendants().slice(1);
            
            // Ê†áÂáÜÂåñÂõ∫ÂÆöÊ∑±Â∫¶ÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºöyËΩ¥Ë°®Á§∫Ê∑±Â∫¶Ôºâ
            nodes.forEach(d => { d.y = d.depth * 150; });
            
            // Êõ¥Êñ∞ËäÇÁÇπ
            const node = g.selectAll('g.node')
                .data(nodes, d => d.id || (d.id = ++i));
            
            // ËøõÂÖ•Êñ∞ËäÇÁÇπ
            const nodeEnter = node.enter().append('g')
                .attr('class', d => {
                    let classes = 'node';
                    if (d.data.is_root) classes += ' root';
                    if (d.data.is_leaf) classes += ' leaf';
                    if (d.data.is_first_incorrect) classes += ' first-incorrect';
                    return classes;
                })
                .attr("transform", d => `translate(${source.x0},${source.y0})`)
                .on('click', (event, d) => {
                    // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°
                    event.stopPropagation();
                    // ÊòæÁ§∫/ÈöêËóè tooltip
                    showTooltip(d, event);
                });
            
            // Ê∑ªÂä†ÂúÜÂúà
            nodeEnter.append('circle')
                .attr('r', 1e-6);
            
            // Êõ¥Êñ∞ËäÇÁÇπÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºöx,yÂùêÊ†áÁõ¥Êé•‰ΩøÁî®d.x,d.yÔºâ
            const nodeUpdate = nodeEnter.merge(node);
            
            nodeUpdate.transition()
                .duration(750)
                .attr("transform", d => `translate(${d.x},${d.y})`);
            
            nodeUpdate.select('circle')
                .transition()
                .duration(750)
                .attr('r', 10)
                .style("fill", d => {
                    if (d.data.is_root) return "#FF9800";
                    if (d.data.is_first_incorrect) return "#F44336";
                    if (d.data.is_leaf) return "#2196F3";
                    return "#4CAF50";
                });
            
            nodeUpdate.select('text')
                .transition()
                .duration(750)
                .style("fill-opacity", 1);
            
            // ÁßªÈô§ËäÇÁÇπ
            const nodeExit = node.exit().transition()
                .duration(750)
                .attr("transform", d => `translate(${source.x},${source.y})`)
                .remove();
            
            nodeExit.select('circle')
                .attr('r', 1e-6);
            
            nodeExit.select('text')
                .style('fill-opacity', 1e-6);
            
            // Êõ¥Êñ∞ËøûÊé•Á∫ø
            const link = g.selectAll('path.link')
                .data(links, d => d.id);
            
            const linkEnter = link.enter().insert('path', "g")
                .attr("class", "link")
                .attr('d', d => {
                    const o = {x: source.x0, y: source.y0};
                    return diagonal(o, o);
                });
            
            const linkUpdate = linkEnter.merge(link);
            
            linkUpdate.transition()
                .duration(750)
                .attr('d', d => diagonal(d, d.parent));
            
            link.exit().transition()
                .duration(750)
                .attr('d', d => {
                    const o = {x: source.x, y: source.y};
                    return diagonal(o, o);
                })
                .remove();
            
            // Â≠òÂÇ®Êóß‰ΩçÁΩÆ
            nodes.forEach(d => {
                d.x0 = d.x;
                d.y0 = d.y;
            });
        }
        
        // È´ò‰∫ÆË∑ØÂæÑ
        function highlightPath(node) {
            // È´ò‰∫Æ‰ªéÊ†πÂà∞ÂΩìÂâçËäÇÁÇπÁöÑË∑ØÂæÑ
            const pathNodes = [];
            let current = node;
            while (current) {
                pathNodes.push(current);
                current = current.parent;
            }
            
            // È´ò‰∫ÆËøûÊé•Á∫ø
            g.selectAll('path.link')
                .classed('highlight', d => pathNodes.includes(d));
        }
        
        // ÁßªÈô§È´ò‰∫Æ
        function removeHighlight() {
            g.selectAll('path.link').classed('highlight', false);
        }
        
        // ÂàõÂª∫ËøûÊé•Á∫øÔºàÂûÇÁõ¥Â∏ÉÂ±ÄÔºöË∞ÉÊï¥Êõ≤Á∫øÊñπÂêëÔºâ
        function diagonal(s, d) {
            const path = `M ${s.x} ${s.y}
                        C ${s.x} ${(s.y + d.y) / 2},
                          ${d.x} ${(s.y + d.y) / 2},
                          ${d.x} ${d.y}`;
            return path;
        }
        
        // ÊéßÂà∂ÂáΩÊï∞
        window.resetZoom = function() {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
            );
        };
        
        // ÈÄÇÂ∫îÁ™óÂè£Â§ßÂ∞è
        window.fitToContainer = function() {
            const containerDims = getContainerDimensions();
            const bounds = g.node().getBBox();
            
            if (bounds.width === 0 || bounds.height === 0) return;
            
            const fullWidth = bounds.width + margin.left + margin.right;
            const fullHeight = bounds.height + margin.top + margin.bottom;
            
            const midX = bounds.x + bounds.width / 2;
            const midY = bounds.y + bounds.height / 2;
            
            const scale = 0.85 / Math.max(fullWidth / containerDims.width, fullHeight / containerDims.height);
            const translate = [containerDims.width / 2 - scale * midX, containerDims.height / 2 - scale * midY];
            
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)
            );
        };
        
        // ÂÖ≥Èó≠tooltipÁöÑÂÖ®Â±ÄÂáΩÊï∞
        window.closeTooltip = closeTooltip;
        
        // ÁÇπÂáªÁ©∫ÁôΩÂå∫ÂüüÂÖ≥Èó≠tooltip
        document.addEventListener('click', (event) => {
            // Â¶ÇÊûúÁÇπÂáªÁöÑ‰∏çÊòØtooltipÂÜÖÈÉ®ÔºåÂàôÂÖ≥Èó≠tooltip
            if (!event.target.closest('.tooltip') && !event.target.closest('.node')) {
                closeTooltip();
            }
        });
        
        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÈáçÊñ∞Ë∞ÉÊï¥
        window.addEventListener('resize', () => {
            setTimeout(() => {
                const newDims = initializeSVG();
                svg = newDims.svg;
                width = newDims.width;
                height = newDims.height;
                margin = newDims.margin;
                treemap.size([width, height]); // ÂûÇÁõ¥Â∏ÉÂ±Ä
                update(root);
                
                // Â¶ÇÊûúÊúâÊ¥ªË∑ÉÁöÑtooltipÔºåÊõ¥Êñ∞ÂÖ∂‰ΩçÁΩÆ
                if (currentActiveNode) {
                    updateTooltipPosition(currentActiveNode);
                }
            }, 100);
        });
        
        // ÂàùÂßãÂåñ
        let i = 0;
        update(root);
        
        // ÂàùÂßãÈÄÇÂ∫îÁ™óÂè£
        setTimeout(() => {
            fitToContainer();
        }, 1000);
    </script>
</body>
</html>